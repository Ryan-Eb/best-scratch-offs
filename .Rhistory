write.csv(game_data,paste0("all_state_csv-",today()))
getwd()
setwd("/Users/jennaryan/Documents/R Projects/all_state/daily_csv")
setwd("/Users/jennaryan/Documents/R Projects/all_states/daily_csv")
write.csv(game_data,paste0("all_state_csv-",today()))
str(game_data)
colnames(game_data)
source("~/Documents/R Projects/all_states/all_state_data.R")
nc_url1 <- "https://nclottery.com/scratch-off-prizes-remaining"
read_html(nc_url1) %>% html_nodes("table")
read_html(nc_url1) %>% html_nodes("table") %>% html_table()
read_html(nc_url1) %>% html_nodes("table") %>% html_table() %>% .[1]
read_html(nc_url1) %>% html_nodes("table") %>% html_table() %>% .[1] %>% view ()
nc_url1 <- "https://nclottery.com/scratch-off"
read_html(nc_url1) %>% html_nodes("a") %>% html_attr("href")
read_html(nc_url1) %>% html_nodes("a") %>% html_attr("href") %>% str_subset("scratch-off")
read_html(nc_url1) %>% html_nodes("a") %>% html_attr("href") %>% str_subset("scratch-off/")
nc_game_links <- paste0("https://nclottery.com/",read_html(nc_url1) %>% html_nodes("a") %>% html_attr("href") %>% str_subset("scratch-off/"))
nc_game_links <- paste0("https://nclottery.com",read_html(nc_url1) %>% html_nodes("a") %>% html_attr("href") %>% str_subset("scratch-off/"))
read_html(nc_game_links[1]) %>% html_nodes("td")
read_html(nc_game_links[1]) %>% html_nodes("table")
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table ()
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% [-1]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticke_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2])
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticke_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2]) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2])
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticke_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2]) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2]) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[3,2])
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticke_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2]) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2]) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2])
str_split("in ",simplify = TRUE) %>% .[2]
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticke_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2]) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2]) %>%
mutate(overall_odds = as.numeric(read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2]))
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticke_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2]) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2]) %>%
mutate(overall_odds = as.numeric(read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2])) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today())
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticke_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2]) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2]) %>%
mutate(overall_odds = as.numeric(read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2])) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>% view()
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2]
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2]) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today())
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today())
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = Value)
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = Value) %>% view()
mutate(prize_amount = str_replace_all(Value,"[$,]","")
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]",""))
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","")) %>%
mutate(total_prizes = str_replace_all(Total,",","")) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","")) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price)
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(Total,",","") %>% as.numeric()) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","") %>% as.numeric()) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price)
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(Total,",","") %>% as.numeric()) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","") %>% as.numeric()) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price) %>% view()
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(Total,",","") %>% as.numeric()) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","") %>% as.numeric()) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price) %>%
relocate(state:scrape_date,.after = ticket_price) %>%
relocate(overall_odds, .after = prizes_claimed)
read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(nc_game_links[1]) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(Total,",","") %>% as.numeric()) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","") %>% as.numeric()) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price) %>%
relocate(state:scrape_date,.after = ticket_price) %>%
relocate(overall_odds, .after = prizes_claimed) %>% view()
nc_url1 <- "https://nclottery.com/scratch-off"
nc_game_links <- paste0("https://nclottery.com",read_html(nc_url1) %>% html_nodes("a") %>% html_attr("href") %>% str_subset("scratch-off/"))
nc_game_data <- data.frame()
for (i in 1:2) {
temp_url <- nc_game_links[i]
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(Total,",","") %>% as.numeric()) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","") %>% as.numeric()) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price) %>%
relocate(state:scrape_date,.after = ticket_price) %>%
relocate(overall_odds, .after = prizes_claimed)
nc_game_data <- bind_rows(nc_game_data, x)
print(paste0(i," of ", length(nc_game_links)))
}
View(nc_game_data)
source("~/Documents/R Projects/all_states/all_state_data.R", echo=TRUE)
source("~/Documents/R Projects/all_states/all_state_data.R", echo=TRUE)
nc_game_links[13]
temp_url <- nc_game_links[1]
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(Total,",","") %>% as.numeric()) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","") %>% as.numeric()) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price) %>%
relocate(state:scrape_date,.after = ticket_price) %>%
relocate(overall_odds, .after = prizes_claimed)
View(x)
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric())
View(x)
View(x)
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all([3],",","") %>% as.numeric())
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(.[3],",","") %>% as.numeric())
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(.[,3],",","") %>% as.numeric())
View(x)
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(Total,",","") %>% as.numeric())
x %>% names([,3])
x %>% names()
x %>% names(3)
x %>% names() %>% 3
x %>% names() %>% .[3]
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(x %>% names() %>% .[3],",","") %>% as.numeric())
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric())
View(x)
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(x %>% names() %>% .[3],",","") %>% as.numeric())
View(x)
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(x %>% names() %>% .[3],",",""))
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(x %>% names() %>% .[3],",",""))
View(x)
x %>% names() %>% .[3]
as.character(x %>% names() %>% .[3])
colnames(x)
colnames(x)
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(names() %>% .[3],",",""))
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(names(.) %>% .[3],",",""))
View(x)
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(Total,",",""))
View(x)
colnames(x) %>%
kj
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(.[[3]],",",""))
View(x)
source("~/Documents/R Projects/all_states/all_state_data.R", echo=TRUE)
for (i in 1:length(nc_game_links)) {
temp_url <- nc_game_links[1]
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(.[[3]],",","") %>% as.numeric()) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","") %>% as.numeric()) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price) %>%
relocate(state:scrape_date,.after = ticket_price) %>%
relocate(overall_odds, .after = prizes_claimed)
nc_game_data <- bind_rows(nc_game_data, x)
print(paste0(i," of ", length(nc_game_links)))
}
nc_end <- Sys.time()
nc_time <- nc_end - nc_start
print(nc_time)
game_data <- bind_rows(fl_game_data, nc_game_data)
View(game_data)
read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric()
nc_url1 <- "https://nclottery.com/scratch-off"
nc_game_links <- paste0("https://nclottery.com",read_html(nc_url1) %>% html_nodes("a") %>% html_attr("href") %>% str_subset("scratch-off/"))
nc_game_data <- data.frame()
for (i in 1:length(nc_game_links)) {
temp_url <- nc_game_links[i]
x <- read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[2]] %>% .[-1,] %>%
mutate(ticket_price = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[2,2] %>%
str_replace_all("[$]","") %>% as.numeric()) %>%
mutate(game_number = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[6,2] %>%
as.numeric()) %>%
mutate(overall_odds = read_html(temp_url) %>% html_nodes("table") %>% html_table () %>% .[[1]] %>% .[4,2] %>%
str_split("in ",simplify = TRUE) %>% .[2] %>% as.numeric()) %>%
mutate(state = "NC") %>%
mutate(scrape_date = today()) %>%
mutate(prize_amount = str_replace_all(Value,"[$,]","") %>% as.numeric()) %>%
mutate(total_prizes = str_replace_all(.[[3]],",","") %>% as.numeric()) %>%
mutate(prizes_remaining =  str_replace_all(Remaining,",","") %>% as.numeric()) %>%
mutate(prizes_claimed = total_prizes - prizes_remaining) %>%
select(-c(1:4)) %>%
relocate(game_number,.before = ticket_price) %>%
relocate(state:scrape_date,.after = ticket_price) %>%
relocate(overall_odds, .after = prizes_claimed)
nc_game_data <- bind_rows(nc_game_data, x)
print(paste0(i," of ", length(nc_game_links)))
}
nc_end <- Sys.time()
nc_time <- nc_end - nc_start
print(nc_time)
View(nc_game_data)
game_data <- bind_rows(fl_game_data, nc_game_data)
View(game_data)
game_data %>% is.na() %>% colSums()
setwd("/Users/jennaryan/Documents/R Projects/all_states/daily_csv")
write.csv(game_data,paste0("all_state_csv-",today()))
View(game_data)
all_state_csv_2023_04_08 <- read_csv("all_state_csv-2023-04-08")
df <- all_state_csv_2023_04_08
df %>%
group_by(state, scrape_date) %>%
summarise(total_prizes_remaining = sum(prizes_remaining*prize_amount))
df %>%
drop_na() %>%
group_by(state, scrape_date) %>%
summarise(total_prizes_remaining = sum(prizes_remaining*prize_amount))
df
df %>% view()
df %>%
group_by(state,game_number,scrape_date) %>%
summarise(number_tickets = sum(total_prizes)*overall_odds)
df %>%
group_by(state,game_number,scrape_date) %>%
summarise(number_tickets = sum(total_prizes)*mean(overall_odds))
df %>%
group_by(state,game_number,scrape_date) %>%
summarise(number_tickets = sum(total_prizes)*overall_odds)
df %>%
group_by(state,game_number,scrape_date) %>%
summarise(number_tickets = sum(total_prizes)*overall_odds[1])
df %>%
group_by(state,game_number,scrape_date) %>%
summarise(number_tickets = sum(total_prizes)*mean(overall_odds))
df %>%
group_by(state,game_number,scrape_date) %>%
summarise(number_tickets = sum(total_prizes)*overall_odds[1])
df %>%
group_by(state,game_number,scrape_date) %>%
summarise(number_tickets = sum(total_prizes)*mean(overall_odds))
